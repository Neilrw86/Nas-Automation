---
- name: dpkg --configure -a
  shell: dpkg --configure -a
  tags:
    - packages
    - common
    - dpkg-reconf

- name: install system utils, packages and stuff...
  package:
    name:
      - apt-transport-https
      - curl
      - figlet
      - genisoimage
      - git
      - git-core
      - goaccess
      - htop
      - libfontconfig
      - libjson-xs-perl
      - lsof
      - multitail
      - neovim
      - netcat
      - net-tools
      - nmap
      - ntp
      - openssl
      - python-pip
      - rsync
      - rsyslog
      - software-properties-common
      - sysstat
      - vim
      - vim-common
      - wget
      - zip
    state: latest
    update_cache: yes
    cache_valid_time: 5400
    allow_unauthenticated: yes
  tags:
    - packages
    - common


# @link http://bencane.com/2012/07/08/sar-sysstat-linux-performance-statistics-with-ease/
- name: enable /etc/default/sysstat
  lineinfile:
    backup: yes
    create: yes
    dest: /etc/default/sysstat
    regexp: '^ENABLED='
    line: 'ENABLED="true"'
    state: present
  tags:
    - common-config
    - packages
    - common



  - name: create the ansible user account
    become: yes
    user: name=ansible append=yes state=present createhome=yes shell=/bin/bash

  - name: allow 'ansible' to use sudo without needing a password
    become: yes
    lineinfile:
        dest: /etc/sudoers
        line: 'ansible ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s'


  - name: Set Authorized key taken from file
    become: yes
    authorized_key:
      user: ansible
      state: present
      key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

  - name: Copy .bash_aliases
    become: yes 
    copy:
      src: bash_aliases
      dest: /etc/profile.d/00-bash_aliases.sh
      owner: neil
      group: neil
      mode: 0644

