# This values.yaml is for your 'readarr-wrapper' chart.
# All configurations for the actual Readarr deployment will be under 'readarr-dependency'
# (the alias defined in Chart.yaml for the media-servarr/readarr chart).
#
# IMPORTANT: You MUST consult the official values.yaml of the media-servarr/readarr chart
# (version 0.8.11) for the precise structure and available options.
# The following is a best-effort configuration based on common patterns.

readarr-dependency:
  image:
    repository: lscr.io/linuxserver/readarr # Standard repository for linuxserver images
    tag: "nightly-0.4.17.2795-ls397" # Matches the appVersion of the chart
    pullPolicy: IfNotPresent

  # Define a global storage class that will be applied to all dynamically provisioned PVCs.
  global:
    storageClass: "nfs-client"

  # Environment variables are typically a map (key: value) in these charts.
  env:
    TZ: "Europe/London"
    PUID: "1003"
    PGID: "1003"

  # Service configuration. The chart uses this to create the Service object
  # and correctly link the Ingress to it.
  service:
    main:
      ports:
        http:
          port: 8787

  ingress:
    main:
      enabled: true
      ingressClassName: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: "0"
        cert-manager.io/cluster-issuer: "letsencrypt-prod-cfdns"
      hosts:
        - host: "readarr.neilwylie.com"
          paths:
            - path: /
              pathType: Prefix
              # The chart will now automatically route this to the 'http' port of the 'main' service.
      tls:
        - secretName: readarr-tls
          hosts:
            - "readarr.neilwylie.com"

  # Persistence configuration. This is the standard way to define volumes.
  persistence:
    config:
      enabled: true # Enable the chart's built-in PVC for config
      type: pvc # Explicitly state we are using a PVC
      # Configure dynamic provisioning using your NFS CSI driver.
      accessMode: ReadWriteMany # Best practice for NFS volumes
      size: 1Gi

  # Manually define additional volumes to ensure they are correctly added to the pod spec.
  # This bypasses any complex logic in the persistence template that may be causing issues.
  additionalVolumes:
    - name: downloads
      persistentVolumeClaim:
        claimName: "nfs-temp-pvc"
    - name: ebooks
      persistentVolumeClaim:
        claimName: "nfs-books-pvc"

  # Manually define the corresponding volume mounts for the container.
  additionalVolumeMounts:
    - name: downloads
      mountPath: /downloads
    - name: ebooks
      mountPath: /books
